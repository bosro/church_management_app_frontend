<!-- src/app/features/members/components/import-members/import-members.component.html -->
<div class="dashboard-layout">
  <app-sidebar></app-sidebar>

  <div class="dashboard-content">
    <app-header></app-header>

    <div class="dashboard-body">
      <div class="import-container">
        <!-- Page Header -->
        <div class="page-header">
          <div class="header-left">
            <button class="back-btn" (click)="cancel()" [disabled]="uploading">
              <i class="ri-arrow-left-line"></i>
            </button>
            <div>
              <h1>Import Members</h1>
              <p class="subtitle">Upload a CSV file to import multiple members at once</p>
            </div>
          </div>
        </div>

        <!-- Success Message -->
        <div *ngIf="successMessage" class="success-alert">
          <i class="ri-checkbox-circle-line"></i>
          <span>{{ successMessage }}</span>
        </div>

        <!-- Error Message -->
        <div *ngIf="errorMessage" class="error-alert">
          <i class="ri-error-warning-line"></i>
          <span>{{ errorMessage }}</span>
          <button class="close-btn" (click)="errorMessage = ''">
            <i class="ri-close-line"></i>
          </button>
        </div>

        <!-- Import Card -->
        <div class="import-card">
          <!-- Instructions -->
          <div class="instructions-section">
            <h3>
              <i class="ri-information-line"></i>
              Instructions
            </h3>
            <ol>
              <li>
                <strong>Download the template:</strong> Click the button below to get the CSV template with sample data
              </li>
              <li>
                <strong>Fill in your data:</strong> Add your member information following the template format. Required fields are marked with *
              </li>
              <li>
                <strong>Remove instructions:</strong> Delete the instruction rows (starting with #) before uploading
              </li>
              <li>
                <strong>Upload the file:</strong> Drag and drop or browse to select your completed CSV file
              </li>
              <li>
                <strong>Review results:</strong> Check the import summary and fix any errors if needed
              </li>
            </ol>

            <button class="btn-template" (click)="downloadTemplate()">
              <i class="ri-download-line"></i>
              Download CSV Template
            </button>
          </div>

          <!-- File Upload Area -->
          <div class="upload-section">
            <div
              class="dropzone"
              [class.dragover]="dragOver"
              [class.has-file]="selectedFile"
              [class.uploading]="uploading"
              (dragover)="onDragOver($event)"
              (dragleave)="onDragLeave($event)"
              (drop)="onDrop($event)"
            >
              <div *ngIf="!selectedFile" class="dropzone-content">
                <i class="ri-upload-cloud-line"></i>
                <h4>Drag & Drop your CSV file here</h4>
                <p>or</p>
                <label class="btn-browse">
                  <i class="ri-folder-open-line"></i>
                  Browse Files
                  <input
                    type="file"
                    accept=".csv,.CSV"
                    (change)="onFileSelected($event)"
                    [disabled]="uploading"
                    hidden
                  />
                </label>
                <span class="file-hint">
                  <i class="ri-information-line"></i>
                  Maximum file size: 10MB â€¢ Accepted format: .CSV
                </span>
              </div>

              <div *ngIf="selectedFile && !importResults" class="file-selected">
                <div class="file-info">
                  <i class="ri-file-text-line"></i>
                  <div class="file-details">
                    <p class="file-name">{{ selectedFile.name }}</p>
                    <p class="file-size">{{ (selectedFile.size / 1024).toFixed(2) }} KB</p>
                  </div>
                  <button
                    class="btn-remove"
                    (click)="removeFile()"
                    *ngIf="!uploading"
                    title="Remove file"
                  >
                    <i class="ri-close-line"></i>
                  </button>
                </div>

                <!-- Upload Progress -->
                <div *ngIf="uploading" class="upload-progress">
                  <div class="progress-bar">
                    <div class="progress-fill" [style.width.%]="uploadProgress"></div>
                  </div>
                  <p class="progress-text">
                    <i class="ri-loader-4-line spin"></i>
                    Processing... {{ uploadProgress }}%
                  </p>
                </div>

                <!-- Upload Button -->
                <button
                  *ngIf="!uploading"
                  class="btn-upload"
                  (click)="uploadFile()"
                >
                  <i class="ri-upload-2-line"></i>
                  Start Import
                </button>
              </div>
            </div>
          </div>

          <!-- Import Results -->
          <div *ngIf="importResults" class="results-section">
            <h3>
              <i class="ri-file-list-3-line"></i>
              Import Results
            </h3>

            <div class="results-summary">
              <div class="result-item success">
                <i class="ri-checkbox-circle-fill"></i>
                <div>
                  <p class="result-count">{{ importResults.success }}</p>
                  <p class="result-label">Members Imported</p>
                </div>
              </div>

              <div class="result-item error" *ngIf="importResults.failed > 0">
                <i class="ri-error-warning-fill"></i>
                <div>
                  <p class="result-count">{{ importResults.failed }}</p>
                  <p class="result-label">Failed</p>
                </div>
              </div>
            </div>

            <!-- Error Details -->
            <div *ngIf="importResults.errors.length > 0" class="error-details">
              <h4>
                <i class="ri-alert-line"></i>
                Errors ({{ importResults.errors.length }})
              </h4>
              <div class="error-list">
                <div *ngFor="let error of importResults.errors; let i = index" class="error-item">
                  <span class="error-number">{{ i + 1 }}</span>
                  <i class="ri-alert-line"></i>
                  <span class="error-text">{{ error }}</span>
                </div>
              </div>
              <p class="error-hint">
                <i class="ri-information-line"></i>
                Fix these errors in your CSV file and import again
              </p>
            </div>

            <!-- Success Message -->
            <div *ngIf="importResults.success > 0 && importResults.failed === 0" class="success-details">
              <i class="ri-checkbox-circle-line"></i>
              <h4>All members imported successfully!</h4>
              <p>{{ importResults.success }} member{{ importResults.success > 1 ? 's' : '' }} have been added to your database.</p>
            </div>

            <!-- Actions -->
            <div class="results-actions">
              <button class="btn-secondary" (click)="removeFile()">
                <i class="ri-upload-line"></i>
                Import Another File
              </button>
              <button class="btn-primary" (click)="goToMembers()">
                <i class="ri-group-line"></i>
                View Members
              </button>
            </div>
          </div>
        </div>

        <!-- Tips Section -->
        <div class="tips-section" *ngIf="!importResults">
          <h3>
            <i class="ri-lightbulb-line"></i>
            Import Tips
          </h3>
          <ul class="tips-list">
            <li>
              <i class="ri-checkbox-circle-line"></i>
              Ensure all required fields (First Name, Last Name, Join Date) are filled
            </li>
            <li>
              <i class="ri-checkbox-circle-line"></i>
              Use the format YYYY-MM-DD for dates (e.g., 2024-01-15)
            </li>
            <li>
              <i class="ri-checkbox-circle-line"></i>
              Phone numbers should be 10 digits without spaces (e.g., 0201234567)
            </li>
            <li>
              <i class="ri-checkbox-circle-line"></i>
              Gender values should be: male, female, or other
            </li>
            <li>
              <i class="ri-checkbox-circle-line"></i>
              The CSV file should not exceed 10MB in size
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>
