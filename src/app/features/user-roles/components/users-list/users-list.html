<!-- src/app/features/user-roles/components/users-list/users-list.component.html -->
<div class="dashboard-layout">
  <app-sidebar></app-sidebar>

  <div class="dashboard-content">
    <app-header></app-header>

    <div class="dashboard-body">
      <div class="users-container">
        <!-- Page Header -->
        <div class="page-header">
          <div class="header-left">
            <h1>User Roles & Permissions</h1>
            <p class="subtitle">Manage user access and permissions</p>
          </div>
          <button
            class="btn-primary"
            (click)="viewRoleTemplates()"
            [disabled]="!canManageRoles"
          >
            <i class="ri-shield-user-line"></i>
            <span class="desktop-only">Role Templates</span>
          </button>
        </div>

        <!-- Success Message -->
        <div *ngIf="successMessage" class="success-alert">
          <i class="ri-checkbox-circle-line"></i>
          <span>{{ successMessage }}</span>
          <button class="close-btn" (click)="clearMessages()">
            <i class="ri-close-line"></i>
          </button>
        </div>

        <!-- Error Message -->
        <div *ngIf="errorMessage" class="error-alert">
          <i class="ri-error-warning-line"></i>
          <span>{{ errorMessage }}</span>
          <button class="close-btn" (click)="clearMessages()">
            <i class="ri-close-line"></i>
          </button>
        </div>

        <!-- Loading State -->
        <div *ngIf="loading" class="loading-container">
          <div class="spinner"></div>
          <p>Loading users...</p>
        </div>

        <!-- Users List -->
        <div *ngIf="!loading" class="users-list">
          <div
            *ngFor="let user of users"
            class="user-card"
            [class.disabled]="!canManagePermissions"
            (click)="managePermissions(user.id)"
          >
            <div class="card-header">
              <div class="user-avatar">
                <img
                  *ngIf="user.avatar_url"
                  [src]="user.avatar_url"
                  [alt]="user.full_name"
                />
                <div *ngIf="!user.avatar_url" class="avatar-placeholder">
                  {{ user.full_name.charAt(0).toUpperCase() }}
                </div>
              </div>
              <div class="user-info">
                <h3>{{ user.full_name }}</h3>
                <p class="user-email">
                  <i class="ri-mail-line"></i>
                  {{ user.email }}
                </p>
                <p class="user-phone" *ngIf="user.phone_number">
                  <i class="ri-phone-line"></i>
                  {{ user.phone_number }}
                </p>
              </div>
              <div class="user-role">
                <span class="role-badge" [ngClass]="getRoleBadgeClass(user.role)">
                  <i class="ri-shield-user-line"></i>
                  {{ getRoleLabel(user.role) }}
                </span>
              </div>
            </div>

            <div class="card-footer">
              <button
                class="btn-manage"
                [disabled]="!canManagePermissions"
                (click)="managePermissions(user.id); $event.stopPropagation()"
              >
                <i class="ri-settings-3-line"></i>
                <span>Manage Permissions</span>
              </button>
            </div>
          </div>

          <!-- Empty State -->
          <div *ngIf="users.length === 0" class="empty-state">
            <i class="ri-user-settings-line"></i>
            <h3>No Users Found</h3>
            <p>No active users available to manage</p>
            <p class="empty-hint">Users will appear here once they are approved and activated</p>
          </div>
        </div>

        <!-- Pagination -->
        <div class="pagination" *ngIf="totalPages > 1 && !loading">
          <button
            class="pagination-btn"
            [disabled]="currentPage === 1"
            (click)="previousPage()"
          >
            <i class="ri-arrow-left-s-line"></i>
            <span class="desktop-only">Previous</span>
          </button>

          <div class="pagination-pages">
            <span class="page-info">
              Page {{ currentPage }} of {{ totalPages }}
              <span class="desktop-only">({{ totalUsers }} users)</span>
            </span>
          </div>

          <button
            class="pagination-btn"
            [disabled]="currentPage === totalPages"
            (click)="nextPage()"
          >
            <span class="desktop-only">Next</span>
            <i class="ri-arrow-right-s-line"></i>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
